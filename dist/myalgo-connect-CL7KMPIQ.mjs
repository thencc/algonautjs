import{c as l,h as i,k as a}from"./chunk-LM3IO2MR.mjs";var S=l((K,W)=>{a();var R={WINDOW_NOT_LOADED:"Window not loaded",WINDOW_IS_OPENED:"Windows is opened",WINDOW_NOT_OPENED:"Can not open popup window",INVALID_WINDOW:"Invalid window"},m=class extends Error{constructor(t,s,r){super(t),this.code=s,this.data=r}};W.exports={ERRORS:R,SignTxnsError:m}});var A=l((Q,N)=>{a();var{WINDOW_NOT_OPENED:L}=S(),k={width:400,height:600};function H(u,t=k){let{name:s="",width:r,height:e,top:n=0,left:o=0}=t;r&&(window.outerWidth?o=Math.round((window.outerWidth-r)/2)+window.screenX:window.screen.width&&(o=Math.round((window.screen.width-r)/2))),e&&(window.outerHeight?n=Math.round((window.outerHeight-e)/2)+window.screenY:window.screen.height&&(n=Math.round((window.screen.height-e)/2))),r&&e&&(t={top:n,left:o,width:r,height:e,status:1,toolbar:0,menubar:0,resizable:1,scrollbars:1});let c=Object.keys(t).map(p=>{let d=t[p];if(d!=null&&typeof d.toString=="function")return`${p}=${d.toString()}`}).filter(Boolean).join(","),h;try{h=window.open(u,s,c)}catch(p){throw new Error(`${L} - ${p.stack||p.message}`)}if(!h||window.closed)throw new Error(`${L} - blocked`);return h}N.exports={openPopup:H}});var T=l((Z,_)=>{a();function j(u=200){return new Promise(t=>setTimeout(t,u))}function $(u){if(u.constructor===Uint8Array)return i.Buffer.from(u).toString("base64");if(typeof u=="string")return u;let t=Object.assign({},u);if(t.note&&t.note.constructor===Uint8Array&&(t.note=i.Buffer.from(t.note).toString("base64")),t.assetMetadataHash&&t.assetMetadataHash.constructor===Uint8Array&&(t.assetMetadataHash=i.Buffer.from(t.assetMetadataHash).toString("base64")),t.group&&t.group.constructor===Uint8Array&&(t.group=i.Buffer.from(t.group).toString("base64")),t.type==="appl"&&t.appApprovalProgram&&t.appApprovalProgram.constructor===Uint8Array&&(t.appApprovalProgram=i.Buffer.from(t.appApprovalProgram).toString("base64")),t.type==="appl"&&t.appClearProgram&&t.appClearProgram.constructor===Uint8Array&&(t.appClearProgram=i.Buffer.from(t.appClearProgram).toString("base64")),t.type==="appl"&&t.appArgs&&t.appArgs.length>0)for(let s=0;s<t.appArgs.length;s++)t.appArgs[s].constructor===Uint8Array&&(t.appArgs[s]=i.Buffer.from(t.appArgs[s]).toString("base64"));return t}_.exports={sleep:j,prepareTxn:$}});var I=l((tt,E)=>{a();var P=class{constructor(t,s){this.channelName=t,this.onMessage=s,this._installListener(),this._requests=new Map,this._nextId=0,this._defaultTimeout=4e3}_installListener(){let t=this;this._listener=function(s){if(!s.data||typeof s.data!="string")return;let r;try{if(r=JSON.parse(s.data),!r.channel||r.channel!==t.channelName||typeof r.message!="object")return}catch{return}if(typeof r.replyId<"u"){if(typeof r.replyId!="number"||r.replyId%1!==0)return;let e=t._requests.get(r.replyId);if(e){if(s.origin!==e.targetOrigin)return;clearTimeout(e.timeout),t._requests.delete(r.replyId),e.resolve(r.message)}}else{if(typeof r.id!="number"||r.id%1!==0||!t.onMessage)return;let e=t.channelName,n=r.id,o=s.origin,c=function(h){let p={channel:e,replyId:n,message:h};s.source.postMessage(JSON.stringify(p),o)};t.onMessage(r.message,s.origin,s.source,c,t)}},window.addEventListener("message",this._listener)}sendMessage(t,s,r,e){let n;try{n=new URL(r).origin}catch{throw new Error("Invalid origin URL")}let o={channel:this.channelName,id:this.getNextId(),message:s};if(e&&e.waitForReply){let c=this;return new Promise(function(h,p){let d=setTimeout(function(){c._requests.get(o.id)&&(c._requests.delete(o.id),p(new Error("Timeout expired for the message response")))},e&&e.timeout?e.timeout:c._defaultTimeout);c._requests.set(o.id,{timeout:d,resolve:h,targetOrigin:n}),t.postMessage(JSON.stringify(o),n)})}t.postMessage(JSON.stringify(o),n)}close(){window.removeEventListener("message",this._listener),this._listener=null,delete this._requests}getNextId(){return this._nextId+=1,this._nextId}};E.exports=P});var M=l((et,O)=>{a();O.exports=I()});var q=l((rt,C)=>{a();var J=M(),v="wallet-bridge-communication-channel",y=class{constructor(t){let s=this;this.options={waitForReply:!0,timeout:250},this.listenerCallback=t,this.bridge=new J(v,function(r,e,n,o){s.listenerCallback&&s.listenerCallback(r,n)})}sendMessage(t,s,r,e){return this.bridge.sendMessage(t,s,r,e||this.options)}setNewListener(t){this.listenerCallback=t}close(){this.bridge.close()}};C.exports=y});var U=l((st,B)=>{a();var{openPopup:w}=A(),{sleep:V,prepareTxn:D}=T(),{Errors:b,SignTxnsError:z}=S(),G=q(),f=null,x=class{constructor(t){f||(f=new G),this.bridge=f,this.timeout=t&&t.timeout?t.timeout:16e5,this.url=t&&t.bridgeUrl?t.bridgeUrl:"https://wallet.myalgo.com/bridge",this.url.endsWith("/")&&(this.url=this.url.slice(0,-1)),this.currentConnectPopup=null,this.currentSigntxPopup=null,this.currentSignLogicSigPopup=null,this.currentTealSignPopup=null,this.currentSignBytesPopup=null,this.options={waitForReply:!0,timeout:this.timeout},this.disableLedgerNano=t&&t.disableLedgerNano?t.disableLedgerNano:!1}async connect(t={shouldSelectOneAccount:!1,openManager:!1}){this.currentConnectPopup&&(this.currentConnectPopup.closed?this.currentConnectPopup=null:this.focusWindow(this.currentConnectPopup));try{this.currentConnectPopup=w(this.url+"/connect.html"),await this.waitForWindowToLoad(this.currentConnectPopup);let s=await this.bridge.sendMessage(this.currentConnectPopup,{method:"unlock",params:Object.assign(t,{disableLedgerNano:this.disableLedgerNano})},this.url,this.options);if(this.closeWindow(this.currentConnectPopup),this.currentConnectPopup=null,s.status==="error")throw new Error(s.message);return s.data.accounts}catch(s){throw this.closeWindow(this.currentConnectPopup),this.currentConnectPopup=null,s}}async signTransaction(t,s){let r;this.currentSigntxPopup&&(this.currentSigntxPopup.closed?this.currentSigntxPopup=null:this.focusWindow(this.currentSigntxPopup)),Array.isArray(t)?r=Array.from(t).map(e=>D(e)):r=D(t);try{this.currentSigntxPopup=w(this.url+"/signtx.html"),await this.waitForWindowToLoad(this.currentSigntxPopup);let e=await this.bridge.sendMessage(this.currentSigntxPopup,{method:"transaction",params:{txn:r,settings:{disableLedgerNano:this.disableLedgerNano},options:s}},this.url,this.options);if(this.closeWindow(this.currentSigntxPopup),this.currentSigntxPopup=null,e.status==="error")throw new Error(e.message);if(Array.isArray(e.data)){let n=[];for(let o of e.data)o.blob=new Uint8Array(i.Buffer.from(o.blob,"hex")),n.push(o);return n}return e.data.blob=new Uint8Array(i.Buffer.from(e.data.blob,"hex")),e.data}catch(e){throw this.closeWindow(this.currentSigntxPopup),this.currentSigntxPopup=null,e}}async signTxns(t,s){this.currentSigntxPopup&&(this.currentSigntxPopup.closed?this.currentSigntxPopup=null:this.focusWindow(this.currentSigntxPopup));try{let r=t;Array.isArray(t)||(r=[t]),this.currentSigntxPopup=w(this.url+"/signtx.html"),await this.waitForWindowToLoad(this.currentSigntxPopup);let e=await this.bridge.sendMessage(this.currentSigntxPopup,{method:"signTxns",params:{txns:r,settings:{disableLedgerNano:this.disableLedgerNano},opts:s}},this.url,this.options);if(this.closeWindow(this.currentSigntxPopup),this.currentSigntxPopup=null,e.status==="error")throw new z(e.message,e.code,e.data);return e.data.map(n=>n?i.Buffer.from(n.blob,"hex").toString("base64"):null)}catch(r){throw this.closeWindow(this.currentSigntxPopup),this.currentSigntxPopup=null,r}}async signLogicSig(t,s){this.currentSignLogicSigPopup&&(this.currentSignLogicSigPopup.closed?this.currentSignLogicSigPopup=null:this.focusWindow(this.currentSignLogicSigPopup));try{this.currentSignLogicSigPopup=w(this.url+"/logicsigtx.html"),await this.waitForWindowToLoad(this.currentSignLogicSigPopup);let r=t;t.constructor===Uint8Array&&(r=i.Buffer.from(t).toString("base64"));let e=await this.bridge.sendMessage(this.currentSignLogicSigPopup,{method:"logicsig",params:{logic:r,address:s}},this.url,this.options);if(this.closeWindow(this.currentSignLogicSigPopup),this.currentSignLogicSigPopup=null,e.status==="error")throw new Error(e.message);return new Uint8Array(i.Buffer.from(e.data.signedTeal,"base64"))}catch(r){throw this.closeWindow(this.currentSignLogicSigPopup),this.currentSignLogicSigPopup=null,r}}async tealSign(t,s,r){this.currentTealSignPopup&&(this.currentTealSignPopup.closed?this.currentTealSignPopup=null:this.focusWindow(this.currentTealSignPopup));try{this.currentTealSignPopup=w(this.url+"/tealsign.html"),await this.waitForWindowToLoad(this.currentTealSignPopup);let e=t;t.constructor===Uint8Array&&(e=i.Buffer.from(t).toString("base64"));let n=await this.bridge.sendMessage(this.currentTealSignPopup,{method:"tealsign",params:{data:e,contractAddress:s,address:r}},this.url,this.options);if(this.closeWindow(this.currentTealSignPopup),this.currentTealSignPopup=null,n.status==="error")throw new Error(n.message);return new Uint8Array(i.Buffer.from(n.data.signature,"base64"))}catch(e){throw this.closeWindow(this.currentTealSignPopup),this.currentTealSignPopup=null,e}}async signBytes(t,s){this.currentSignBytesPopup&&(this.currentSignBytesPopup.closed?this.currentSignBytesPopup=null:this.focusWindow(this.currentSignBytesPopup));try{this.currentSignBytesPopup=w(this.url+"/signbytes.html"),await this.waitForWindowToLoad(this.currentSignBytesPopup);let r=i.Buffer.from(t).toString("base64"),e=await this.bridge.sendMessage(this.currentSignBytesPopup,{method:"signbytes",params:{data:r,address:s}},this.url,this.options);if(this.closeWindow(this.currentSignBytesPopup),this.currentSignBytesPopup=null,e.status==="error")throw new Error(e.message);return new Uint8Array(i.Buffer.from(e.data.signature,"base64"))}catch(r){throw this.closeWindow(this.currentSignBytesPopup),this.currentSignBytesPopup=null,r}}async waitForWindowToLoad(t,s=30){for(let r=0;r<s&&(await V(300),!!t);r++)try{if((await f.sendMessage(t,{method:"status"},this.url)).status=="success")return}catch{}throw new Error(b.WINDOW_NOT_LOADED)}closeWindow(t){t&&!t.closed&&t.close&&t.close()}focusWindow(t){throw t&&t.focus?(t.focus(),new Error(b.WINDOW_IS_OPENED)):new Error(b.INVALID_WINDOW)}};B.exports=x});var X=l((it,F)=>{a();F.exports=U()});export default X();
//# sourceMappingURL=myalgo-connect-CL7KMPIQ.mjs.map
